<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Saving Lives Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Google Maps,Locations Overview
Android Geo Programming Concepts and Play Services Setup
GMaps
G Maps Directions API
GeoLocation
G Geocoding API
GPlaces - tons of devz


EX1-WORKS-PKJ: GMaps v2, Conc">
<meta property="og:type" content="article">
<meta property="og:title" content="Saving Lives Blog">
<meta property="og:url" content="https://pradeepkr103.github.io/android/31b Android Maps v2 Markers, Current Location/index.html">
<meta property="og:site_name" content="Saving Lives Blog">
<meta property="og:description" content="Google Maps,Locations Overview
Android Geo Programming Concepts and Play Services Setup
GMaps
G Maps Directions API
GeoLocation
G Geocoding API
GPlaces - tons of devz


EX1-WORKS-PKJ: GMaps v2, Conc">
<meta property="og:updated_time" content="2016-12-20T09:35:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Saving Lives Blog">
<meta name="twitter:description" content="Google Maps,Locations Overview
Android Geo Programming Concepts and Play Services Setup
GMaps
G Maps Directions API
GeoLocation
G Geocoding API
GPlaces - tons of devz


EX1-WORKS-PKJ: GMaps v2, Conc">
  
    <link rel="alternate" href="/atom.xml" title="Saving Lives Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Saving Lives Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">For the emerging 5 Billion global citizens.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://pradeepkr103.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-android/31b Android Maps v2 Markers, Current Location" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/android/31b Android Maps v2 Markers, Current Location/" class="article-date">
  <time datetime="2016-12-20T09:23:01.000Z" itemprop="datePublished">2016-12-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- MarkdownTOC -->
<ul>
<li>Google Maps,Locations Overview<ul>
<li>Android Geo Programming Concepts and Play Services Setup</li>
<li>GMaps</li>
<li>G Maps Directions API</li>
<li>GeoLocation</li>
<li>G Geocoding API</li>
<li>GPlaces - tons of devz</li>
</ul>
</li>
<li>EX1-WORKS-PKJ: GMaps v2, Concepts - Map Basics &amp; MARKER<ul>
<li>Manifest add permissions</li>
<li>MapsActivity add MapFragment</li>
<li>Map Marker, Position, Camera Animation, Current Location button</li>
<li>Google API Client setup</li>
<li>Implements Callbacks</li>
<li>Map Types</li>
<li>Zoom +/-</li>
</ul>
</li>
<li>EX2-WORKS-PKJ: Current Location, Google Play Client API<ul>
<li>Current Place  - Needs GoogleApiClient - allows setting Type of Maps, Callbacks</li>
<li>Main Activity Basic Setup</li>
<li>Setup Map</li>
<li>Setup Android Auth/Keys for FusedLocationProviderApi needs GoogleApiClient</li>
<li>FusedLocationProviderApi - Location API overview</li>
<li>Lifecycle &amp; GPlay API callbacks - setup</li>
<li>Current Location button enabled &amp; Change detection ..</li>
<li>Geocoding - Search &amp; lookup custom marker ..</li>
</ul>
</li>
<li>EX3 Markers, Custom Info Windows<ul>
<li>SETUP: Check play serviecs</li>
<li>SETUP: Check if GPlay services available</li>
<li>SETUP: Build GPlay Client, ask Location Updates</li>
<li>SETUP: Google Play Callbacks</li>
<li>SETUP: Permissions Checking, and API level</li>
<li>ORIENTATION CHANGES: Manage maps state</li>
<li>MARKERS</li>
<li>CUSTOM INFO WINDOW</li>
<li>Managing Markers, Polygons</li>
</ul>
</li>
</ul>
<!-- /MarkdownTOC -->
<h1 id="Google-Maps-Locations-Overview"><a href="#Google-Maps-Locations-Overview" class="headerlink" title="Google Maps,Locations Overview"></a>Google Maps,Locations Overview</h1><h2 id="Android-Geo-Programming-Concepts-and-Play-Services-Setup"><a href="#Android-Geo-Programming-Concepts-and-Play-Services-Setup" class="headerlink" title="Android Geo Programming Concepts and Play Services Setup"></a>Android Geo Programming Concepts and Play Services Setup</h2><h2 id="GMaps"><a href="#GMaps" class="headerlink" title="GMaps"></a>GMaps</h2><pre><code>Google Maps
Google Maps API  &lt;- mashups, overlays limited to pushpins,lines,polygons

Google Maps Enterprise
Google Earth
Google Earth Pro
Google Maps Engine Lite/Pro  upload csv,esri,kml data for multilayer, collab decision &lt;-- killed
    Mangomap.com $s
Google My Maps - simple pin on maps 
Google Maps for Work
Mkt your business - http://www.google.com/maps/about/partners/
</code></pre><ul>
<li>G Maps 101 - see the Dev Guide<ul>
<li><a href="https://developers.google.com/maps/documentation/android-api/" target="_blank" rel="external">https://developers.google.com/maps/documentation/android-api/</a></li>
</ul>
</li>
</ul>
<ul>
<li><p>YT Tech Academy GMaps pt1,2,3 - </p>
</li>
<li><p><a href="https://github.com/vivianaranha/AndroidClassroomTraining" target="_blank" rel="external">https://github.com/vivianaranha/AndroidClassroomTraining</a> see Projects/MapsApp<br>YT  Pt 2 - see Pt1, 3, 4 - <a href="https://www.youtube.com/watch?v=Z3mKhMkdUFk" target="_blank" rel="external">https://www.youtube.com/watch?v=Z3mKhMkdUFk</a></p>
</li>
</ul>
<h2 id="G-Maps-Directions-API"><a href="#G-Maps-Directions-API" class="headerlink" title="G Maps Directions API"></a>G Maps Directions API</h2><p><a href="https://developers.google.com/maps/documentation/directions/" target="_blank" rel="external">https://developers.google.com/maps/documentation/directions/</a></p>
<h2 id="GeoLocation"><a href="#GeoLocation" class="headerlink" title="GeoLocation"></a>GeoLocation</h2><ul>
<li><p>Simple Tutes</p>
</li>
<li><p>OLD</p>
</li>
</ul>
<ul>
<li>Aug’11 Android Geolocation Tutorial (Android Location Manager) <a href="https://www.youtube.com/watch?v=7-n6p6RxSS8" target="_blank" rel="external">https://www.youtube.com/watch?v=7-n6p6RxSS8</a></li>
</ul>
<h2 id="G-Geocoding-API"><a href="#G-Geocoding-API" class="headerlink" title="G Geocoding API"></a>G Geocoding API</h2><p><a href="https://developers.google.com/maps/documentation/geocoding/" target="_blank" rel="external">https://developers.google.com/maps/documentation/geocoding/</a></p>
<h2 id="GPlaces-tons-of-devz"><a href="#GPlaces-tons-of-devz" class="headerlink" title="GPlaces - tons of devz"></a>GPlaces - tons of devz</h2><pre><code>see ~gdr/trainCSBooks/IOT,M2M,RoboTech,Geo,Pro/34 Geo POI,GPlaces.md
https://developers.google.com/places/android-api/
</code></pre><h1 id="EX1-WORKS-PKJ-GMaps-v2-Concepts-Map-Basics-amp-MARKER"><a href="#EX1-WORKS-PKJ-GMaps-v2-Concepts-Map-Basics-amp-MARKER" class="headerlink" title="EX1-WORKS-PKJ: GMaps v2, Concepts - Map Basics &amp; MARKER"></a>EX1-WORKS-PKJ: GMaps v2, Concepts - Map Basics &amp; MARKER</h1><ul>
<li><p>Note this got merged into the .. next Current location<br>~z/GeoGISMaps/aPKJTutesGMap/aPKJTut_GMapEx1_Markers_Ex2_Curlocation  12/5/16<br>GMap v2 - API 17+<br>  Google maps activity<br>  in strings set key to AIzaSyBI8R97TFlBf7zhZiNNXD2JUZxbUnpoWdo<br>  Note how this key is not translatable - doesnt really matter if you dont use auto translate tools<br>  PROBLEM: This key is used in Android manifest - but key is defined in generated app</p>
<pre><code>only in google_maps_api.xml
</code></pre>  <string name="google_maps_key" templatemergestrategy="preserve" translatable="false">AIzaSyBI8R97TFlBf7zhZiNNXD2JUZxbUnpoWdo</string>
</li>
<li><p>Here the LatLng is set explicitly </p>
<ul>
<li>Note to find LatLng of a location in google maps, right click and Whats Here .. will tell coordinates.</li>
</ul>
</li>
</ul>
<h2 id="Manifest-add-permissions"><a href="#Manifest-add-permissions" class="headerlink" title="Manifest add permissions"></a>Manifest add permissions</h2><pre><code>&lt;manifest ..&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot; /&gt;

    &lt;application
        &lt;meta-data android:name=&quot;com.google.android.geo.API_KEY&quot; android:value=&quot;@string/google_maps_key&quot; /&gt;

        &lt;activity .. MapsActivity
</code></pre><h2 id="MapsActivity-add-MapFragment"><a href="#MapsActivity-add-MapFragment" class="headerlink" title="MapsActivity add MapFragment"></a>MapsActivity add MapFragment</h2><pre><code>* xml
&lt;fragment xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
xmlns:map=&quot;http://schemas.android.com/apk/res-auto&quot;
xmlns:tools=&quot;http://schemas.android.com/tools&quot;
android:id=&quot;@+id/map&quot;
android:name=&quot;com.google.android.gms.maps.SupportMapFragment&quot;
android:layout_width=&quot;match_parent&quot;
android:layout_height=&quot;match_parent&quot;
tools:context=&quot;com.gomobilefirst.pkjgmapsample01.MapsActivity&quot; /&gt;


public class MapsActivity extends FragmentActivity implements OnMapReadyCallback {
    private GoogleMap mMap;
    @Override protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.maps_activity);
        // Obtain the SupportMapFragment and get notified when the map is ready to be used.
        SupportMapFragment mapFragment = (SupportMapFragment) getSupportFragmentManager()
                .findFragmentById(R.id.map);
        mapFragment.getMapAsync(this);
    }
    /**
     * Manipulates the map once available.
     * This callback is triggered when the map is ready to be used.
     * This is where we can add markers or lines, add listeners or move the camera. In this case,
     * we just add a marker near Sydney, Australia.
     * If Google Play services is not installed on the device, the user will be prompted to install
     * it inside the SupportMapFragment. This method will only be triggered once the user has
     * installed Google Play services and returned to the app.
     */
    @Override public void onMapReady(GoogleMap googleMap) {
        mMap = googleMap;

        // Add a marker in Sydney and move the camera
        LatLng sydney = new LatLng(-34, 151);
        mMap.addMarker(new MarkerOptions().position(sydney).title(&quot;Marker in Sydney&quot;));
        mMap.moveCamera(CameraUpdateFactory.newLatLng(sydney));
    }
}
</code></pre><h2 id="Map-Marker-Position-Camera-Animation-Current-Location-button"><a href="#Map-Marker-Position-Camera-Animation-Current-Location-button" class="headerlink" title="Map Marker, Position, Camera Animation, Current Location button"></a>Map Marker, Position, Camera Animation, Current Location button</h2><ul>
<li>If you want to jut add multiple markers just do multiple ..<br>  mMap.addMarker(new MarkerOptions().position(LatLng(0,0)).title(“Marker near here”));</li>
</ul>
<ul>
<li>After marker is added, you can change center point of map using Camera APIs<br>  LatLng here = new LatLng(0,0);<br>  mMap.moveCamera(CameraUpdateFactory.newLatLng(here));</li>
</ul>
<h2 id="Google-API-Client-setup"><a href="#Google-API-Client-setup" class="headerlink" title="Google API Client setup"></a>Google API Client setup</h2><ul>
<li><p>Create the client and setup success/error callbacks, APIs used ..<br>  @Override public void onViewCreated(View view, Bundle savedInstanceState) {</p>
<pre><code>super.onViewCreated(view, savedInstanceState);
setHasOptionsMenu(true);
mGoogleApiClient = new GoogleApiClient.Builder( getActivity() )
        .addConnectionCallbacks( this )
        .addOnConnectionFailedListener( this )
        .addApi( LocationServices.API )
        .build();
initListeners();
</code></pre><p>  }</p>
</li>
<li><p>The initListeners method binds the interfaces that you declared at the top of the class with the GoogleMap object associated with SupportMapFragment. This is what the implementation looks like:</p>
<p>  private void initListeners() {</p>
<pre><code>getMap().setOnMarkerClickListener(this);
getMap().setOnMapLongClickListener(this);
getMap().setOnInfoWindowClickListener( this );
getMap().setOnMapClickListener(this);
</code></pre><p>  }</p>
</li>
</ul>
<p>You may have noticed that the GoogleApiClient and listeners are created and bound from onViewCreated rather than the typical onCreate. This is because the GoogleMap object has not been initialized when onCreate is called, so we need to wait until the view is fully created before trying to call getMap in order to avoid a NullPointerException.</p>
<h2 id="Implements-Callbacks"><a href="#Implements-Callbacks" class="headerlink" title="Implements Callbacks"></a>Implements Callbacks</h2><ul>
<li>ConnectionCallbacks - state of the GoogleApiClient SUCCESS</li>
<li><p>OnConnectionFailedListener  - state of the GoogleApiClient FAILED</p>
</li>
<li><p>OnInfoWindowClickListener is triggered when the user clicks on the info window that pops up over a marker on the map.</p>
</li>
<li><p>OnMapLongClickListener and OnMapClickListener are triggered when the user either taps or holds down on a portion of the map.</p>
</li>
<li><p>OnMarkerClickListener is called when the user clicks on a marker on the map, which typically also displays the info window for that marker.</p>
</li>
</ul>
<h2 id="Map-Types"><a href="#Map-Types" class="headerlink" title="Map Types"></a>Map Types</h2><pre><code>private GoogleApiClient mGoogleApiClient;
private Location mCurrentLocation;
private final int[] MAP_TYPES = { GoogleMap.MAP_TYPE_SATELLITE,  // like birds eye
                                  GoogleMap.MAP_TYPE_NORMAL,     // simplified &quot;street map&quot;
                                  GoogleMap.MAP_TYPE_HYBRID,     // streets overlayed on birds eye
                                  GoogleMap.MAP_TYPE_TERRAIN,    // like streets - textured terrain 
                                          // esp visible when angled using a 2 finger drag
                                  GoogleMap.MAP_TYPE_NONE };    // none - street with no LABELS
private int curMapTypeIndex = 0;


@Override public boolean onCreateOptionsMenu(Menu menu) {
    getMenuInflater().inflate(R.menu.menu, menu);
    return super.onCreateOptionsMenu(menu);
}
public boolean onOptionsItemSelected(MenuItem item) {
    switch (item.getItemId()) {
    case R.id.mapTypeNone:
        mGoogleMap.setMapType(GoogleMap.MAP_TYPE_NONE);
        break;
    case R.id.mapTypeNormal:
        mGoogleMap.setMapType(GoogleMap.MAP_TYPE_NORMAL);
        break;
    case R.id.mapTypeSatellite:
        mGoogleMap.setMapType(GoogleMap.MAP_TYPE_SATELLITE);
        break;
    case R.id.mapTypeTerrain:
        mGoogleMap.setMapType(GoogleMap.MAP_TYPE_TERRAIN);
        break;
    case R.id.mapTypeHybrid:
        mGoogleMap.setMapType(GoogleMap.MAP_TYPE_HYBRID);
        break;
    default:
        break;
    }
    return super.onOptionsItemSelected(item);
}
</code></pre><h2 id="Zoom"><a href="#Zoom" class="headerlink" title="Zoom +/-"></a>Zoom +/-</h2><pre><code>SRC:https://www.youtube.com/watch?v=J3R4b-KauuI
</code></pre><ul>
<li>UXD - trick is to overlay mapfragment and properly overlay it ..<br>  +<br>  -</li>
</ul>
<p>public void onZoom(View v) {<br>    if (v.getId()== R.id.zoomInBut) {<br>        mMap.animateCamera(CameraUpdateFactory.zoomIn());<br>    }<br>    if (v.getId() == R.id.zoomOutBut) {<br>        mMap.animateCamera(CameraUpdateFactory.zoomOut());<br>    }<br>}</p>
<h1 id="EX2-WORKS-PKJ-Current-Location-Google-Play-Client-API"><a href="#EX2-WORKS-PKJ-Current-Location-Google-Play-Client-API" class="headerlink" title="EX2-WORKS-PKJ: Current Location, Google Play Client API"></a>EX2-WORKS-PKJ: Current Location, Google Play Client API</h1><ul>
<li><p>Code at ..<br>~z/GeoGISMaps/aPKJTutesGMap/aPKJTut_GMapEx2_Markers_Ex2_Curlocation  12/5/16</p>
<p> SRC:<a href="https://developers.google.com/maps/documentation/android-api/current-places-tutorial" target="_blank" rel="external">https://developers.google.com/maps/documentation/android-api/current-places-tutorial</a></p>
</li>
</ul>
<h2 id="Current-Place-Needs-GoogleApiClient-allows-setting-Type-of-Maps-Callbacks"><a href="#Current-Place-Needs-GoogleApiClient-allows-setting-Type-of-Maps-Callbacks" class="headerlink" title="Current Place  - Needs GoogleApiClient - allows setting Type of Maps, Callbacks"></a>Current Place  - Needs GoogleApiClient - allows setting Type of Maps, Callbacks</h2><ul>
<li>Show map with a given LatLong or current position .. Merger of tutes from ..</li>
</ul>
<p>SRC: BLOG V2+gh <a href="https://code.tutsplus.com/tutorials/getting-started-with-google-maps-for-android-basics--cms-24635" target="_blank" rel="external">https://code.tutsplus.com/tutorials/getting-started-with-google-maps-for-android-basics--cms-24635</a><br>    <a href="https://github.com/tutsplus/Android-GoogleMaps-Part1" target="_blank" rel="external">https://github.com/tutsplus/Android-GoogleMaps-Part1</a><br>    <a href="https://github.com/tutsplus/Android-GoogleMaps-Part2" target="_blank" rel="external">https://github.com/tutsplus/Android-GoogleMaps-Part2</a><br>    <a href="https://github.com/tutsplus/Android-GoogleMaps-Part3" target="_blank" rel="external">https://github.com/tutsplus/Android-GoogleMaps-Part3</a><br>    <a href="http://stackoverflow.com/questions/28128946/caused-by-java-lang-nullpointerexception-attempt-to-invoke-interface-method-on" target="_blank" rel="external">http://stackoverflow.com/questions/28128946/caused-by-java-lang-nullpointerexception-attempt-to-invoke-interface-method-on</a></p>
<ul>
<li><p>Basic permissions - this is all that it takes for map markers, current location, fused location ..<br>  &lt;manifest</p>
<pre><code>&lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot; /&gt;
</code></pre>  <application ..="" <meta-data="" android:name="com.google.android.geo.API_KEY" android:value="@string/google_maps_key">
</application></li>
<li><p>Key stored in values/strings.xml</p>
  <resources><br>      <string name="google_maps_key" templatemergestrategy="preserve" translatable="false">AIzaSyBI8R97TFlBf7zhZiNNXD2JUZxbUnpoWdo</string><br>  </resources>


</li>
</ul>
<ul>
<li><p>UXD</p>
<p>  <strong><strong><strong>__</strong></strong></strong> <search></search></p>
  <map (+)="" <-----="" go="" to="" curlocation="" button="" added="" in="" fragment="" ...="">

</map></li>
</ul>
<h2 id="Main-Activity-Basic-Setup"><a href="#Main-Activity-Basic-Setup" class="headerlink" title="Main Activity Basic Setup"></a>Main Activity Basic Setup</h2><ul>
<li>XML  <linearlayout android:layout_width="wrap_content" android:layout_height="wrap_content" xmlns:android="http://schemas.android.com/apk/res/android" android:orientation="vertical"><br>      <linearlayout android:orientation="horizontal" android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_gravity="center_horizontal"><br>      <edittext android:id="@+id/TFaddress" android:layout_width="280dp" android:layout_height="wrap_content"><br>      <button android:id="@+id/search" android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Search" android:layout_gravity="right" android:onclick="onSearch"><br>      </button></edittext></linearlayout><br>      <fragment xmlns:android="http://schemas.android.com/apk/res/android" xmlns:map="http://schemas.android.com/apk/res-auto" xmlns:tools="http://schemas.android.com/tools" android:id="@+id/map" android:name="com.google.android.gms.maps.SupportMapFragment" android:layout_width="match_parent" android:layout_height="match_parent" tools:context="com.gomobilefirst.pkjgmapsample01.MapsActivity"><br>  </fragment></linearlayout>



</li>
</ul>
<ul>
<li><p>MapsActivity.java .. basic mMap onCreate,onResume, google client sequencing</p>
<p>  public static final String TAG = MapsActivity.class.getSimpleName();<br>  private final static int CONNECTION_FAILURE_RESOLUTION_REQUEST = 9000;<br>  private GoogleApiClient mGoogleApiClient= null;<br>  Marker mCurrLocationMarker;</p>
<p>  public class MapsActivity extends FragmentActivity implements</p>
<pre><code>OnMapReadyCallback,  // basic google maps
GoogleApiClient.ConnectionCallbacks, GoogleApiClient.OnConnectionFailedListener,  // basic google api callbacks
LocationListener {      // basic current fused location listener

private GoogleMap mMap; // can be null if GPlay Services apk not available

@Override protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState); setContentView(R.layout.maps_activity);
    buildGoogleApiClient();
    setUpMapIfNeeded();
}
@Override protected void onResume() {
    super.onResume();
    setUpMapIfNeeded();
    mGoogleApiClient.connect();
}
@Override protected void onPause() {
    super.onPause();
    if (mGoogleApiClient.isConnected()) {
        LocationServices.FusedLocationApi.removeLocationUpdates(mGoogleApiClient, this);
        mGoogleApiClient.disconnect();
    }
}
private void setUpMapIfNeeded() {
    // Do a null check to confirm that we have not already instantiated the map.
    if (this.mMap == null) { // Try to obtain the map from the SupportMapFragment.
        SupportMapFragment mapFragment= (SupportMapFragment) getSupportFragmentManager().findFragmentById(R.id.map);
        mapFragment.getMapAsync(this);
    }
}
</code></pre></li>
</ul>
<ul>
<li><p>Note buildGoogleApiClient() has to have been called already or it crashes! </p>
<p>  protected synchronized void buildGoogleApiClient() {</p>
<pre><code>if (mGoogleApiClient == null) {
    mGoogleApiClient = new GoogleApiClient.Builder(this)
        //??EXTRA .enableAutoManage(this /* FragmentActivity */, this /* OnConnectionFailedListener */)
        .addConnectionCallbacks(this)
        .addOnConnectionFailedListener(this)
        .addApi(LocationServices.API) //Uses the addApi() method to request the Google Places API and the Fused Location Provider.
        //GPLACES-API .addApi(Places.GEO_DATA_API)
        //GPLACES-API .addApi(Places.PLACE_DETECTION_API)
        .build();
    //??EXTRA createLocationRequest();
}
</code></pre><p>  }</p>
</li>
</ul>
<h2 id="Setup-Map"><a href="#Setup-Map" class="headerlink" title="Setup Map"></a>Setup Map</h2><ul>
<li><p>note buildGoogleApiClient() has to have been called already or it crashes! </p>
<p>/**</p>
<ul>
<li>Manipulates the map once available.</li>
<li>This callback is triggered when the map is ready to be used.</li>
<li>This is where we can add markers or lines, add listeners or move the camera. In this case,</li>
<li>we just add a marker near Sydney, Australia.</li>
<li>If Google Play services is not installed on the device, the user will be prompted to install</li>
<li>it inside the SupportMapFragment. This method will only be triggered once the user has</li>
<li>installed Google Play services and returned to the app.<br>*/<br>@Override public void onMapReady(GoogleMap googleMap) {<br> mMap = googleMap;<br> mMap.setMapType(GoogleMap.MAP_TYPE_HYBRID);<pre><code>//Initialize Google Play Services
</code></pre> if (android.os.Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) {<pre><code>if (ContextCompat.checkSelfPermission(this, android.Manifest.permission.ACCESS_FINE_LOCATION)
        == PackageManager.PERMISSION_GRANTED) {
    //Location Permission already granted
    buildGoogleApiClient();
    mMap.setMyLocationEnabled(true);
} else {
    //Request Location Permission
    checkLocationPermission();
}
</code></pre> } else {<pre><code>buildGoogleApiClient();
mMap.setMyLocationEnabled(true);
</code></pre> }<pre><code>// Add a marker in Sydney and move the camera
</code></pre> LatLng here = new LatLng(0,0);  // sydney -34, 151<br> mMap.addMarker(new MarkerOptions().position(here).title(“Marker Here”));<br> mMap.addMarker(new MarkerOptions().position(new LatLng(37.394680, -122.076218)).title(“Caltrain Mountain View”));<br> mMap.addMarker(new MarkerOptions().position(new LatLng(37.378662, -122.030803)).title(“Caltrain Sunnyvale”));<br> mMap.moveCamera(CameraUpdateFactory.newLatLng(here));<br>}</li>
</ul>
</li>
</ul>
<h2 id="Setup-Android-Auth-Keys-for-FusedLocationProviderApi-needs-GoogleApiClient"><a href="#Setup-Android-Auth-Keys-for-FusedLocationProviderApi-needs-GoogleApiClient" class="headerlink" title="Setup Android Auth/Keys for FusedLocationProviderApi needs GoogleApiClient"></a>Setup Android Auth/Keys for FusedLocationProviderApi needs GoogleApiClient</h2><p>GoogleApiClient - FusedLocationProviderApi requires the GoogleApiClient instance to get the Location and it can be obtained as below.</p>
<pre><code>googleApiClient = new GoogleApiClient.Builder(locationActivity)
            .addApi(LocationServices.API)
            .addConnectionCallbacks(this)
            .addOnConnectionFailedListener(this)
            .build();
</code></pre><p>Instantiating the GoogleApiClient should be done in onCreate of the application Activity.</p>
<ul>
<li>googleApiClient.connect() should be done in onStart and disconnect() in onStop.</li>
</ul>
<p>When the GoogleApiClient is connected successfully, onConnected(Bundle) callback will be called. There we should register with LocationListener for location updates as - </p>
<pre><code>LocationServices.FusedLocationApi.requestLocationUpdates(mGoogleApiClient, mLocationRequest, this);
</code></pre><h2 id="FusedLocationProviderApi-Location-API-overview"><a href="#FusedLocationProviderApi-Location-API-overview" class="headerlink" title="FusedLocationProviderApi - Location API overview"></a>FusedLocationProviderApi - Location API overview</h2><p>With respect to fused location provider, we can broadly classify the API usage in three use cases.</p>
<ul>
<li><p>getLastLocation(GoogleApiClient) this API should be used when there is no need for continuous access to location from an application. Like one shot access or get user location based on some action. This is the simplified way to get the device location and also may not provide high accuracy.</p>
</li>
<li><p>requestLocationUpdates(GoogleApiClient,LocationRequest, LocationListener) this API should be used when there a need for continuous location updates and the location is accessed when the application is active in foreground.</p>
</li>
<li><p>requestLocationUpdates (GoogleApiClient, LocationRequest, PendingIntent) this API is used to receive location updates in the background even when the application is not active. So the difference is PendingIntent.</p>
</li>
</ul>
<h2 id="Lifecycle-amp-GPlay-API-callbacks-setup"><a href="#Lifecycle-amp-GPlay-API-callbacks-setup" class="headerlink" title="Lifecycle &amp; GPlay API callbacks - setup"></a>Lifecycle &amp; GPlay API callbacks - setup</h2><ul>
<li><p>Concepts<br>  @Override public void onConnected(@Nullable Bundle bundle) </p>
<pre><code>.. setup location request objects setup here .. 
</code></pre><p>  onResume</p>
<ul>
<li><p>to reconnect gAPI if necessary</p>
<p>onStop</p>
<ul>
<li>to turn off location updates</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>Google Play Callbacks Simple Implementations</p>
<p>  @Override public void onConnected(Bundle connectionHint) {</p>
<pre><code>getDeviceLocation();
SupportMapFragment mapFragment = (SupportMapFragment) getSupportFragmentManager()  // Build the map.
        .findFragmentById(R.id.map);
mapFragment.getMapAsync(this);
</code></pre><p>  }<br>  @Override public void onLocationChanged(Location location) {</p>
<pre><code>mCurrentLocation = location
updateMarkers();
</code></pre><p>  }</p>
</li>
</ul>
<pre><code>        // Handles suspension of the connection to the Google Play services client.
@Override public void onConnectionSuspended(int i) { 
    Log.d(TAG, &quot;Play services connection suspended&quot;);
}

          // Handles failure to connect to the Google Play services client.
@Override public void onConnectionFailed(@NonNull ConnectionResult connectionResult) { 
        // Refer to the reference doc for ConnectionResult to see what error codes might
        // be returned in onConnectionFailed.
    Log.d(TAG, &quot;Play services connection failed: ConnectionResult.getErrorCode() = &quot;
            + result.getErrorCode());
}
</code></pre><h2 id="Current-Location-button-enabled-amp-Change-detection"><a href="#Current-Location-button-enabled-amp-Change-detection" class="headerlink" title="Current Location button enabled &amp; Change detection .."></a>Current Location button enabled &amp; Change detection ..</h2><ul>
<li><p>Note the G Play onConnected() callback would setup the location request  and setup location updates</p>
<p>  private LocationRequest mLocationRequest;<br>  Location mLastLocation;</p>
<p>  @Override public void onConnected(@Nullable Bundle bundle) {</p>
<pre><code>/**  // Create the LocationRequest object
mLocationRequest = LocationRequest.create()
        .setPriority(LocationRequest.PRIORITY_HIGH_ACCURACY)
        .setInterval(10 * 1000)        // 10 seconds, in milliseconds
        .setFastestInterval(1 * 1000); // 1 second, in milliseconds
**/
mLocationRequest = new LocationRequest();
mLocationRequest.setInterval(1000);
mLocationRequest.setFastestInterval(1000);
mLocationRequest.setPriority(LocationRequest.PRIORITY_BALANCED_POWER_ACCURACY);
if (ContextCompat.checkSelfPermission(this,
        android.Manifest.permission.ACCESS_FINE_LOCATION)
        == PackageManager.PERMISSION_GRANTED) {
    LocationServices.FusedLocationApi.requestLocationUpdates(mGoogleApiClient, mLocationRequest, this);
}
</code></pre><p>  }</p>
</li>
</ul>
<pre><code>@Override public void onLocationChanged(Location location) {
    mLastLocation = location;
    if (mCurrLocationMarker != null) {
        mCurrLocationMarker.remove();
    }
        //Place current location marker
    LatLng latLng = new LatLng(location.getLatitude(), location.getLongitude());
    MarkerOptions markerOptions = new MarkerOptions();
    markerOptions.position(latLng);
    markerOptions.title(&quot;Current Position&quot;);
    markerOptions.icon(BitmapDescriptorFactory.defaultMarker(BitmapDescriptorFactory.HUE_MAGENTA));
    mCurrLocationMarker = mMap.addMarker(markerOptions);
        //move map camera
    mMap.moveCamera(CameraUpdateFactory.newLatLng(latLng));
    mMap.animateCamera(CameraUpdateFactory.zoomTo(11));
        //optionally, stop location updates if only current location is needed
    if (mGoogleApiClient != null) {
        LocationServices.FusedLocationApi.removeLocationUpdates(mGoogleApiClient, this);
    }
}
</code></pre><ul>
<li><p>??NOT USED - Show the cur-location button - ONLY WORKS IF WRAPPED WITH PROPER permissions<br>  mMap.setMyLocationEnabled(true);</p>
<p>  mMap.setOnMyLocationButtonClickListener(new GoogleMap.OnMyLocationButtonClickListener() {</p>
<pre><code>@Override public boolean onMyLocationButtonClick() {
     if (mGoogleApiClient != null) {
         LocationServices.FusedLocationApi.requestLocationUpdates(mGoogleApiClient, mLocationRequest, this);
     }
     return false;
}
</code></pre><p>  });</p>
</li>
</ul>
<h2 id="Geocoding-Search-amp-lookup-custom-marker"><a href="#Geocoding-Search-amp-lookup-custom-marker" class="headerlink" title="Geocoding - Search &amp; lookup custom marker .."></a>Geocoding - Search &amp; lookup custom marker ..</h2><pre><code>public void onSearch(View view) {
    EditText et = (EditText) findViewById(R.id.TFaddress);
    String location = et.getText().toString();
    List&lt;Address&gt; addrRg = null;
    if (location != null &amp;&amp; !location.equals(&quot;&quot;) ) {
        Geocoder geocoder = new Geocoder(this);
        try {
            addrRg = geocoder.getFromLocationName(location, 1);
        } catch (IOException e) {
            e.printStackTrace();
        }
        if (addrRg != null) {
            Address address = addrRg.get(0);
            LatLng newAddrLatLng = new LatLng(address.getLatitude(), address.getLongitude());
            mMap.addMarker(new MarkerOptions().position(newAddrLatLng).title(location));
            mMap.animateCamera(CameraUpdateFactory.newLatLng(newAddrLatLng));
        }
    }
}
</code></pre><ul>
<li><p>Alternative Geo Coding - on view button<br>  public void geoLocate(View view) throws IOException {</p>
<pre><code>EditText et = (EditText) findViewById(R.id.editText);
String location = et.getText().toString();
Geocoder gc = new Geocoder(this);
List&lt;Address&gt; list = gc.getFromLocationName(location, 1);
Address address = list.get(0);
String locality = address.getLocality();
Toast.makeText(this, locality, Toast.LENGTH_LONG).show();
double lat = address.getLatitude();
double lng = address.getLongitude();
goToLocationZoom(lat, lng, 15);
setMarker(locality, lat, lng);
</code></pre><p>  }</p>
<p>  private void goToLocation(double lat, double lng) {</p>
<pre><code>LatLng ll = new LatLng(lat, lng);
CameraUpdate update = CameraUpdateFactory.newLatLng(ll);
mGoogleMap.moveCamera(update);
</code></pre><p>  }<br>  private void goToLocationZoom(double lat, double lng, float zoom) {</p>
<pre><code>LatLng ll = new LatLng(lat, lng);
CameraUpdate update = CameraUpdateFactory.newLatLngZoom(ll, zoom);
mGoogleMap.moveCamera(update);
</code></pre><p>  }</p>
</li>
</ul>
<p>`</p>
<h1 id="EX3-Markers-Custom-Info-Windows"><a href="#EX3-Markers-Custom-Info-Windows" class="headerlink" title="EX3 Markers, Custom Info Windows"></a>EX3 Markers, Custom Info Windows</h1><p>SRC: cde@ GMaps Pt1-4 Vivian .. <a href="https://www.youtube.com/watch?v=lchyOhPREh4" target="_blank" rel="external">https://www.youtube.com/watch?v=lchyOhPREh4</a><br>    DN-CODE: ~z/GeoGISMaps/gMapLocation/AndroidClassroomTraining/Projects/Maps/MapsApp/</p>
<h2 id="SETUP-Check-play-serviecs"><a href="#SETUP-Check-play-serviecs" class="headerlink" title="SETUP: Check play serviecs"></a>SETUP: Check play serviecs</h2><ul>
<li><p>MapsActivity</p>
<p>  private static final int GPS_ERRORDIALOG_REQUEST = 9001;<br>  GoogleMap mMap;<br>  @Override protected void onCreate(Bundle savedInstanceState) {</p>
<pre><code>super.onCreate(savedInstanceState);
if (servicesOK()) {Toast.makeText(this, &quot;Ready to map!&quot;, Toast.LENGTH_SHORT).show(); }
setContentView(R.layout.activity_main);
</code></pre><p>  }<br>  public boolean servicesOK() {</p>
<pre><code>int isAvailable = GooglePlayServicesUtil.isGooglePlayServicesAvailable(this);
if (isAvailable == ConnectionResult.SUCCESS) {return true; }
else if (GooglePlayServicesUtil.isUserRecoverableError(isAvailable)) {
    Dialog dialog = GooglePlayServicesUtil.getErrorDialog(isAvailable, this, GPS_ERRORDIALOG_REQUEST);
    dialog.show();
} else {Toast.makeText(this, &quot;Can&apos;t connect to Google Play services&quot;, Toast.LENGTH_SHORT).show(); }
return false;
</code></pre><p>  }</p>
</li>
</ul>
<h2 id="SETUP-Check-if-GPlay-services-available"><a href="#SETUP-Check-if-GPlay-services-available" class="headerlink" title="SETUP: Check if GPlay services available"></a>SETUP: Check if GPlay services available</h2><ul>
<li><p>Don’t init view if services not available<br>  MapsActivity</p>
<pre><code> onCreate(Bundle savedInstanceState) 
 super.onCreate(savedInstanceState);
 if (googleServicesAvailable()) {
     Toast.makeText(this, &quot;Perfect!!!&quot;, Toast.LENGTH_LONG).show();
     setContentView(R.layout.activity_main);
     MapFragment mapFragment = (MapFragment) getFragmentManager().findFragmentById(R.id.mapFragment);
     mapFragment.getMapAsync(this);
 } else {  // No Google Maps Layout
     finish(); //if there is a home activity to return to ... 
 }

public boolean googleServicesAvailable() {
     GoogleApiAvailability api = GoogleApiAvailability.getInstance();
     int isAvailable = api.isGooglePlayServicesAvailable(this);
     if (isAvailable == ConnectionResult.SUCCESS) {
         return true;
     } else if (api.isUserResolvableError(isAvailable)) {
         Dialog dialog = api.getErrorDialog(this, isAvailable, 0);
         dialog.show();
     } else {
         Toast.makeText(this, &quot;Cant connect to play services&quot;, Toast.LENGTH_LONG).show();
     }
     return false;
 }
</code></pre></li>
</ul>
<h2 id="SETUP-Build-GPlay-Client-ask-Location-Updates"><a href="#SETUP-Build-GPlay-Client-ask-Location-Updates" class="headerlink" title="SETUP: Build GPlay Client, ask Location Updates"></a>SETUP: Build GPlay Client, ask Location Updates</h2><ul>
<li><p>buildGoogleApiClient()</p>
<pre><code>    // The desired interval for location updates. Inexact. Updates may be more or less frequent.
private static final long UPDATE_INTERVAL_IN_MILLISECONDS = 10000;
    // The fastest rate for active location updates. Exact. Updates will never be more frequent than this value.
private static final long FASTEST_UPDATE_INTERVAL_IN_MILLISECONDS = UPDATE_INTERVAL_IN_MILLISECONDS / 2;
private static final int DEFAULT_ZOOM = 15;

private LocationRequest mLocationRequest; // A request object to store parameters for requests to the FusedLocationProviderApi
    // Sets up the location request.
private void createLocationRequest() {
    mLocationRequest = new LocationRequest();
    /*
     * Sets the desired interval for active location updates. This interval is
     * inexact. You may not receive updates at all if no location sources are available, or
     * you may receive them slower than requested. You may also receive updates faster than
     * requested if other applications are requesting location at a faster interval.
     */
    mLocationRequest.setInterval(UPDATE_INTERVAL_IN_MILLISECONDS);
    /*
     * Sets the fastest rate for active location updates. This interval is exact, and your
     * application will never receive updates faster than this value.
     */
    mLocationRequest.setFastestInterval(FASTEST_UPDATE_INTERVAL_IN_MILLISECONDS);
    mLocationRequest.setPriority(LocationRequest.PRIORITY_HIGH_ACCURACY);
}
</code></pre></li>
</ul>
<h2 id="SETUP-Google-Play-Callbacks"><a href="#SETUP-Google-Play-Callbacks" class="headerlink" title="SETUP: Google Play Callbacks"></a>SETUP: Google Play Callbacks</h2><ul>
<li><p>Connected</p>
<pre><code>@Override public void onConnected(Bundle connectionHint) {
    getDeviceLocation();
    SupportMapFragment mapFragment = (SupportMapFragment) getSupportFragmentManager()  // Build the map.
            .findFragmentById(R.id.map);
    mapFragment.getMapAsync(this);
}

        // Gets the current location of the device and starts the location update notifications
private void getDeviceLocation() {
    private static final int PERMISSIONS_REQUEST_ACCESS_FINE_LOCATION = 1;
    private boolean mLocationPermissionGranted;
/*
 * Request location permission, so that we can get the location of the
 * device. The result of the permission request is handled by a callback,
 * onRequestPermissionsResult.
 */
if (ContextCompat.checkSelfPermission(this.getApplicationContext(), android.Manifest.permission.ACCESS_FINE_LOCATION)
        == PackageManager.PERMISSION_GRANTED) {
    mLocationPermissionGranted = true;
} else {
    ActivityCompat.requestPermissions(this,
            new String[]{android.Manifest.permission.ACCESS_FINE_LOCATION},
            PERMISSIONS_REQUEST_ACCESS_FINE_LOCATION);
}
/*
 * Get the best and most recent location of the device, which may be null in rare
 * cases when a location is not available.
 * Also request regular updates about the device location.
 */
if (mLocationPermissionGranted) {
    mCurrentLocation = LocationServices.FusedLocationApi.getLastLocation(mGoogleApiClient);
    LocationServices.FusedLocationApi.requestLocationUpdates(mGoogleApiClient,
            mLocationRequest, this);
}
</code></pre><p>  }</p>
<pre><code>// Handles the result of the request for location permissions.
</code></pre><p>  @Override public void onRequestPermissionsResult(int requestCode, @NonNull String permissions[], @NonNull int[] grantResults) {</p>
<pre><code>mLocationPermissionGranted = false;
switch (requestCode) {
    case PERMISSIONS_REQUEST_ACCESS_FINE_LOCATION: { // If request is cancelled, the result arrays are empty.
        if (grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {
            mLocationPermissionGranted = true;
        }
    }
}
updateLocationUI();
</code></pre><p>  }</p>
</li>
</ul>
<h2 id="SETUP-Permissions-Checking-and-API-level"><a href="#SETUP-Permissions-Checking-and-API-level" class="headerlink" title="SETUP: Permissions Checking, and API level"></a>SETUP: Permissions Checking, and API level</h2><ul>
<li><p>Alert permissions support &amp; setup CURRENT LOCATION CURSOR!</p>
<p>  public static final int MY_PERMISSIONS_REQUEST_LOCATION = 99;<br>  private void checkLocationPermission() {</p>
<pre><code>if (ContextCompat.checkSelfPermission(this, android.Manifest.permission.ACCESS_FINE_LOCATION)
        != PackageManager.PERMISSION_GRANTED) {
            // Should we show an explanation?
    if (ActivityCompat.shouldShowRequestPermissionRationale(this,
            android.Manifest.permission.ACCESS_FINE_LOCATION)) {
        // Show an explanation to the user *asynchronously* -- don&apos;t block
        // this thread waiting for the user&apos;s response! After the user
        // sees the explanation, try again to request the permission.
        new AlertDialog.Builder(this)
                .setTitle(&quot;Location Permission Needed&quot;)
                .setMessage(&quot;This app needs the Location permission, please accept to use location functionality&quot;)
                .setPositiveButton(&quot;OK&quot;, new DialogInterface.OnClickListener() {
                    @Override public void onClick(DialogInterface dialogInterface, int i) {
                        //Prompt the user once explanation has been shown
                        ActivityCompat.requestPermissions(MapsActivity.this,
                                new String[]{android.Manifest.permission.ACCESS_FINE_LOCATION},
                                MY_PERMISSIONS_REQUEST_LOCATION );
                    }
                })
                .create()
                .show();
    } else { // No explanation needed, we can request the permission.
        ActivityCompat.requestPermissions(this,
                new String[]{android.Manifest.permission.ACCESS_FINE_LOCATION},
                MY_PERMISSIONS_REQUEST_LOCATION );
    }
}
</code></pre><p>  }</p>
<p>  @Override public void onRequestPermissionsResult(int requestCode, String permissions[], int[] grantResults) {</p>
<pre><code>switch (requestCode) {
    case MY_PERMISSIONS_REQUEST_LOCATION: {
        // If request is cancelled, the result arrays are empty.
        if (grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {
            // permission was granted, yay! Do the
            // location-related task you need to do.
            if (ContextCompat.checkSelfPermission(this, android.Manifest.permission.ACCESS_FINE_LOCATION)
                    == PackageManager.PERMISSION_GRANTED) {
                if (mGoogleApiClient == null) {
                    buildGoogleApiClient();
                }
                mMap.setMyLocationEnabled(true);
            }
        } else {
            // permission denied, boo! Disable the functionality that depends on this permission.
            Toast.makeText(this, &quot;permission denied&quot;, Toast.LENGTH_LONG).show();
        }
        return;
    }
    // other &apos;case&apos; lines to check for other permissions this app might request
}
</code></pre><p>  }</p>
</li>
</ul>
<h2 id="ORIENTATION-CHANGES-Manage-maps-state"><a href="#ORIENTATION-CHANGES-Manage-maps-state" class="headerlink" title="ORIENTATION CHANGES: Manage maps state"></a>ORIENTATION CHANGES: Manage maps state</h2><ul>
<li><p>by bundle save instance .. </p>
<pre><code>    private CameraPosition mCameraPosition;
    private Location mCurrentLocation; // The geographical location where the device is currently located.
    private GoogleApiClient mGoogleApiClient; // for Google Play services, used by the Places API and Fused LocationProvider.
    // Keys for storing activity state.
    private static final String KEY_CAMERA_POSITION = &quot;camera_position&quot;;
    private static final String KEY_LOCATION = &quot;location&quot;;

@Override protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    if (savedInstanceState != null) { // Retrieve location and camera position from saved instance state.
        mCurrentLocation = savedInstanceState.getParcelable(KEY_LOCATION);
        mCameraPosition = savedInstanceState.getParcelable(KEY_CAMERA_POSITION);
    }
    setContentView(R.layout.activity_maps); // Retrieve the content view that renders the map.
    buildGoogleApiClient();  // Build the Play services client for use by the Fused Location Provider and the Places API.
    mGoogleApiClient.connect();
}
@Override protected void onResume() { // Get the device location and nearby places when the activity is restored after a pause.
    super.onResume();
    if (mGoogleApiClient.isConnected()) {
        getDeviceLocation();
    }
    updateMarkers();
}
@Override protected void onPause() { // Stop location updates when the activity is no longer in focus, to reduce battery consumption.
    super.onPause();
    if (mGoogleApiClient.isConnected()) {
        LocationServices.FusedLocationApi.removeLocationUpdates(mGoogleApiClient, this);
    }
}
@Override protected void onSaveInstanceState(Bundle outState) { // Saves the state of the map when the activity is paused.
    if (mMap != null) {
        outState.putParcelable(KEY_CAMERA_POSITION, mMap.getCameraPosition());
        outState.putParcelable(KEY_LOCATION, mCurrentLocation);
        super.onSaveInstanceState(outState);
    }
}
</code></pre></li>
</ul>
<h2 id="MARKERS"><a href="#MARKERS" class="headerlink" title="MARKERS"></a>MARKERS</h2><ul>
<li>MapReady<pre><code>    // Manipulates the map when it&apos;s available. This callback is triggered when the map is ready to be used.
@Override public void onMapReady(GoogleMap map) {
    mMap = map;
    updateLocationUI(); // Turn on the My Location layer and the related control on the map.
    updateMarkers();  // Add markers for nearby places.
        // Use a custom info window adapter to handle multiple lines of text in the info window contents.
    mMap.setInfoWindowAdapter(new GoogleMap.InfoWindowAdapter() {
            // Return null here, so that getInfoContents() is called next.
        @Override public View getInfoWindow(Marker arg0) {
            return null;
        }
        @Override public View getInfoContents(Marker marker) {
            // Inflate the layouts for the info window, title and snippet.
            View infoWindow = getLayoutInflater().inflate(R.layout.custom_info_contents, null);
            TextView title = ((TextView) infoWindow.findViewById(R.id.title));
            title.setText(marker.getTitle());
            TextView snippet = ((TextView) infoWindow.findViewById(R.id.snippet));
            snippet.setText(marker.getSnippet());
            return infoWindow;
        }
    });
    /*
     * Set the map&apos;s camera position to the current location of the device.
     * If the previous state was saved, set the position to the saved state.
     * If the current location is unknown, use a default position and zoom value.
     */
    if (mCameraPosition != null) {
        mMap.moveCamera(CameraUpdateFactory.newCameraPosition(mCameraPosition));
    } else if (mCurrentLocation != null) {
        mMap.moveCamera(CameraUpdateFactory.newLatLngZoom(
                new LatLng(mCurrentLocation.getLatitude(),
                        mCurrentLocation.getLongitude()), DEFAULT_ZOOM));
    } else {
        Log.d(TAG, &quot;Current location is null. Using defaults.&quot;);
        mMap.moveCamera(CameraUpdateFactory.newLatLngZoom(mDefaultLocation, DEFAULT_ZOOM));
        mMap.getUiSettings().setMyLocationButtonEnabled(false);
    }
}
</code></pre></li>
</ul>
<pre><code>    // Adds markers for places nearby the device and turns the My Location feature on or off
    // if location permission has been granted
private void updateMarkers() {
    if (mMap == null) {
        return;
    }
    if (mLocationPermissionGranted) {
            // Get the businesses and other points of interest located nearest to the device&apos;s current location.
        @SuppressWarnings(&quot;MissingPermission&quot;)
        PendingResult&lt;PlaceLikelihoodBuffer&gt; result = Places.PlaceDetectionApi.getCurrentPlace(mGoogleApiClient, null);
        result.setResultCallback(new ResultCallback&lt;PlaceLikelihoodBuffer&gt;() {
            @Override public void onResult(@NonNull PlaceLikelihoodBuffer likelyPlaces) {
                for (PlaceLikelihood placeLikelihood : likelyPlaces) {
                    // Add a marker for each place near the device&apos;s current location, with an
                    // info window showing place information.
                    String attributions = (String) placeLikelihood.getPlace().getAttributions();
                    String snippet = (String) placeLikelihood.getPlace().getAddress();
                    if (attributions != null) {
                        snippet = snippet + &quot;\n&quot; + attributions;
                    }
                    mMap.addMarker(new MarkerOptions()
                            .position(placeLikelihood.getPlace().getLatLng())
                            .title((String) placeLikelihood.getPlace().getName())
                            .snippet(snippet));
                }
                // Release the place likelihood buffer.
                likelyPlaces.release();
            }
        });
    } else {
        mMap.addMarker(new MarkerOptions()
                .position(mDefaultLocation)
                .title(getString(R.string.default_info_title))
                .snippet(getString(R.string.default_info_snippet)));
    }
}

    // Updates the map&apos;s UI settings based on whether the user has granted location permission.
    @SuppressWarnings(&quot;MissingPermission&quot;)
private void updateLocationUI() {
    if (mMap == null) {
        return;
    }
    if (mLocationPermissionGranted) {
        mMap.setMyLocationEnabled(true);
        mMap.getUiSettings().setMyLocationButtonEnabled(true);
    } else {
        mMap.setMyLocationEnabled(false);
        mMap.getUiSettings().setMyLocationButtonEnabled(false);
        mCurrentLocation = null;
    }
}
</code></pre><h2 id="CUSTOM-INFO-WINDOW"><a href="#CUSTOM-INFO-WINDOW" class="headerlink" title="CUSTOM INFO WINDOW"></a>CUSTOM INFO WINDOW</h2><ul>
<li><p>MapReady</p>
<pre><code>GoogleMap mGoogleMap;
GoogleApiClient mGoogleApiClient;
LocationRequest mLocationRequest;
Marker marker;

@Override public void onMapReady(GoogleMap googleMap) {
    mGoogleMap = googleMap;
    if(mGoogleMap != null){
        mGoogleMap.setOnMapLongClickListener(new GoogleMap.OnMapLongClickListener() {
            @Override public void onMapLongClick(LatLng latLng) {
                MainActivity.this.setMarker(&quot;Local&quot;, latLng.latitude, latLng.longitude);
            }
        });
        mGoogleMap.setOnMarkerDragListener(new GoogleMap.OnMarkerDragListener() {
            @Override public void onMarkerDragStart(Marker marker) {}
            @Override public void onMarkerDrag(Marker marker) {  }
            @Override public void onMarkerDragEnd(Marker marker) {
                Geocoder gc = new Geocoder(MainActivity.this);
                LatLng ll = marker.getPosition();
                double lat = ll.latitude;
                double lng = ll.longitude;
                List&lt;Address&gt; list = null;
                try {
                    list = gc.getFromLocation(lat, lng, 1);
                } catch (IOException e) {
                    e.printStackTrace();
                }
                Address add = list.get(0);
                marker.setTitle(add.getLocality());
                marker.showInfoWindow();
            }
        });
        mGoogleMap.setInfoWindowAdapter(new GoogleMap.InfoWindowAdapter(){
            @Override public View getInfoWindow(Marker marker) {
                return null;
            }
            @Override public View getInfoContents(Marker marker) {
                View v = getLayoutInflater().inflate(R.layout.info_window, null);
                TextView tvLocality = (TextView) v.findViewById(R.id.tv_locality);
                TextView tvLat = (TextView) v.findViewById(R.id.tv_lat);
                TextView tvLng = (TextView) v.findViewById(R.id.tv_lng);
                TextView tvSnippet = (TextView) v.findViewById(R.id.tv_snippet);
                LatLng ll = marker.getPosition();
                tvLocality.setText(marker.getTitle());
                tvLat.setText(&quot;Latitude: &quot; + ll.latitude);
                tvLng.setText(&quot;Longitude: &quot; + ll.longitude);
                tvSnippet.setText(marker.getSnippet());
                return v;
            }
        });
    }

    goToLocationZoom(39.008224, -76.8984527, 15);

    /*
    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) {
        if (checkSelfPermission(Manifest.permission.ACCESS_FINE_LOCATION) 
              != PackageManager.PERMISSION_GRANTED &amp;&amp; checkSelfPermission(Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {
            // TODO: Consider calling
            //    public void requestPermissions(@NonNull String[] permissions, int requestCode)
            // here to request the missing permissions, and then overriding
            //   public void onRequestPermissionsResult(int requestCode, String[] permissions,
            //                                          int[] grantResults)
            // to handle the case where the user grants the permission. See the documentation
            // for Activity#requestPermissions for more details.
            return;
        }
    }
    mGoogleMap.setMyLocationEnabled(true);
    mGoogleApiClient = new GoogleApiClient.Builder(this)
            .addApi(LocationServices.API)
            .addConnectionCallbacks(this)
            .addOnConnectionFailedListener(this)
            .build();
    mGoogleApiClient.connect();
    */
}

private void goToLocation(double lat, double lng) {
    LatLng ll = new LatLng(lat, lng);
    CameraUpdate update = CameraUpdateFactory.newLatLng(ll);
    mGoogleMap.moveCamera(update);
}
private void goToLocationZoom(double lat, double lng, float zoom) {
    LatLng ll = new LatLng(lat, lng);
    CameraUpdate update = CameraUpdateFactory.newLatLngZoom(ll, zoom);
    mGoogleMap.moveCamera(update);
}
</code></pre></li>
</ul>
<ul>
<li><p>info_window.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot;
    android:orientation=&quot;horizontal&quot; &gt;
    &lt;ImageView android:id=&quot;@+id/imageView1&quot;
        android:layout_width=&quot;100dp&quot; android:layout_height=&quot;100dp&quot;
        android:src=&quot;@mipmap/ic_launcher&quot; /&gt;
    &lt;LinearLayout  android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;match_parent&quot;
        android:orientation=&quot;vertical&quot; &gt;
        &lt;TextView android:id=&quot;@+id/tv_locality&quot;
            android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;TextView&quot; android:textSize=&quot;20sp&quot; /&gt;
        &lt;TextView  android:id=&quot;@+id/tv_lat&quot; 
            android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;TextView&quot; /&gt;
        &lt;TextView android:id=&quot;@+id/tv_lng&quot;
            android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;TextView&quot; /&gt;
        &lt;TextView android:id=&quot;@+id/tv_snippet&quot;
            android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot;
            android:text=&quot;TextView&quot; /&gt;
    &lt;/LinearLayout&gt;
&lt;/LinearLayout&gt;
</code></pre></li>
</ul>
<h2 id="Managing-Markers-Polygons"><a href="#Managing-Markers-Polygons" class="headerlink" title="Managing Markers, Polygons"></a>Managing Markers, Polygons</h2><pre><code>/*
            //    Marker marker1;
            //    Marker marker2;
            //    Polyline line;
    private void drawLine() {
        PolylineOptions options = new PolylineOptions()
                .add(marker1.getPosition())
                .add(marker2.getPosition())
                .color(Color.BLUE)
                .width(3);
        line = mGoogleMap.addPolyline(options);
    }

            //    Circle circle;
    private Circle drawCircle(LatLng latLng) {
        CircleOptions options = new CircleOptions()
                .center(latLng)
                .radius(1000)
                .fillColor(0x33FF0000)
                .strokeColor(Color.BLUE)
                .strokeWidth(3);

        return mGoogleMap.addCircle(options);
    }
*/

ArrayList&lt;Marker&gt; markers = new ArrayList&lt;Marker&gt;();
static final int POLYGON_POINTS = 5;
Polygon shape;
private void setMarker(String locality, double lat, double lng) {
      // if(marker != null){ removeEverything();  }
    if(markers.size() == POLYGON_POINTS){
        removeEverything();
    }
    MarkerOptions options = new MarkerOptions()
                        .title(locality)
                        .draggable(true)
                        .icon(BitmapDescriptorFactory.fromResource(R.mipmap.ic_launcher))
                        .position(new LatLng(lat, lng))
                        .snippet(&quot;I am Here&quot;);
    markers.add(mGoogleMap.addMarker(options));
    if(markers.size() == POLYGON_POINTS){
        drawPolygon();
    }

    /*  
    if(marker1 == null) {
        marker1 = mGoogleMap.addMarker(options);
    } else if(marker2 == null) {
        marker2 = mGoogleMap.addMarker(options);
        drawLine();
    } else {
        removeEverything();
        marker1 = mGoogleMap.addMarker(options);
    }
    circle = drawCircle(new LatLng(lat, lng));
    */
}

private void drawPolygon() {
    PolygonOptions options = new PolygonOptions()
            .fillColor(0x330000FF)
            .strokeWidth(3)
            .strokeColor(Color.RED);
    for(int i=0; i&lt;POLYGON_POINTS;i++){
        options.add(markers.get(i).getPosition());
    }
    shape = mGoogleMap.addPolygon(options);
}

private void removeEverything() {
    for(Marker marker : markers) {
        marker.remove();
    }
    markers.clear();
    shape.remove();
    shape = null;

}
/*
    private void removeEverything(){
        marker1.remove();
        marker1 = null;
        marker2.remove();
        marker2 = null;
        line.remove();
        //        circle.remove();
        //        circle = null;
        //    
    }
*/
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://pradeepkr103.github.io/android/31b Android Maps v2 Markers, Current Location/" data-id="ciwyar8z80005fvsp29y319vh" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/android/31g Android Map Paths, Directions, GPS Trackers/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/android/31f Android Geo,Fence Tutorial/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Recipes-ViewManager/">Android, Recipes, ViewManager</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ecommerce-Posts-Directory/">Ecommerce, Posts Directory</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ElasticSearch-Logstash-Kibana-ELK-Google-Analytics-Search-Engines-SEO-Dashboards-Auto-Analytics-Web-Frontend/">ElasticSearch, Logstash, Kibana, ELK, Google Analytics, Search Engines, SEO, Dashboards, Auto-Analytics, Web, Frontend</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Google-Analytics-Search-Engines-SEO-Dashboards-Auto-Analytics-Web-Frontend/">Google Analytics, Search Engines, SEO, Dashboards, Auto-Analytics, Web, Frontend</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Google-Analytics-Web-Frontend/">Google, Analytics, Web, Frontend</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Google-Yahoo-Bing-Search-Engines-SEO-Dashboards-Auto-Analytics-Web-Frontend/">Google, Yahoo, Bing, Search Engines, SEO, Dashboards, Auto-Analytics, Web, Frontend</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mobile-Analytics-Google-Analytics-Search-Engines-SEO-Dashboards-Auto-Analytics-Web-Frontend/">Mobile Analytics, Google Analytics, Search Engines, SEO, Dashboards, Auto-Analytics, Web, Frontend</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Personalizing-Web-Experience-Google-Analytics-Search-Engines-SEO-Dashboards-Auto-Analytics-Web-Frontend/">Personalizing, Web Experience, Google Analytics, Search Engines, SEO, Dashboards, Auto-Analytics, Web, Frontend</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Piwik-Google-Analytics-Web-Frontend/">Piwik, Google, Analytics, Web, Frontend</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/savinglives-hackathons-wins/">savinglives, hackathons, wins</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android-Recipes-ViewManager/" style="font-size: 10px;">Android, Recipes, ViewManager</a> <a href="/tags/Ecommerce-Posts-Directory/" style="font-size: 10px;">Ecommerce, Posts Directory</a> <a href="/tags/ElasticSearch-Logstash-Kibana-ELK-Google-Analytics-Search-Engines-SEO-Dashboards-Auto-Analytics-Web-Frontend/" style="font-size: 10px;">ElasticSearch, Logstash, Kibana, ELK, Google Analytics, Search Engines, SEO, Dashboards, Auto-Analytics, Web, Frontend</a> <a href="/tags/Google-Analytics-Search-Engines-SEO-Dashboards-Auto-Analytics-Web-Frontend/" style="font-size: 20px;">Google Analytics, Search Engines, SEO, Dashboards, Auto-Analytics, Web, Frontend</a> <a href="/tags/Google-Analytics-Web-Frontend/" style="font-size: 10px;">Google, Analytics, Web, Frontend</a> <a href="/tags/Google-Yahoo-Bing-Search-Engines-SEO-Dashboards-Auto-Analytics-Web-Frontend/" style="font-size: 20px;">Google, Yahoo, Bing, Search Engines, SEO, Dashboards, Auto-Analytics, Web, Frontend</a> <a href="/tags/Mobile-Analytics-Google-Analytics-Search-Engines-SEO-Dashboards-Auto-Analytics-Web-Frontend/" style="font-size: 10px;">Mobile Analytics, Google Analytics, Search Engines, SEO, Dashboards, Auto-Analytics, Web, Frontend</a> <a href="/tags/Personalizing-Web-Experience-Google-Analytics-Search-Engines-SEO-Dashboards-Auto-Analytics-Web-Frontend/" style="font-size: 10px;">Personalizing, Web Experience, Google Analytics, Search Engines, SEO, Dashboards, Auto-Analytics, Web, Frontend</a> <a href="/tags/Piwik-Google-Analytics-Web-Frontend/" style="font-size: 10px;">Piwik, Google, Analytics, Web, Frontend</a> <a href="/tags/savinglives-hackathons-wins/" style="font-size: 10px;">savinglives, hackathons, wins</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/android/31a Setup Google Play Services API projects/">(no title)</a>
          </li>
        
          <li>
            <a href="/android/31h Google Places, Local Based/">(no title)</a>
          </li>
        
          <li>
            <a href="/android/31c Android Location,GPS Trackers and Map Tracking/">(no title)</a>
          </li>
        
          <li>
            <a href="/android/31g Android Map Paths, Directions, GPS Trackers/">(no title)</a>
          </li>
        
          <li>
            <a href="/android/31b Android Maps v2 Markers, Current Location/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Pradeep Kumar<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>